<p class="uk-text-right"><i>本文记录了笔者在Win10的Linux子系统下安装MariaDB并进行配置的过程。</i></p>
<p>  笔者的开发环境是Windows10，部署使用的是Windows10的Linux子系统（WSL），这样省了很多麻烦，前面的文章也介绍过类似的的内容，这里不再赘述。顺便提一下，目前Linux子系统已经有很多，包括有Ubuntu、openSUSE、SUSE Linux、Debian、Kali等，笔者由于习惯的原因，使用的是Debian。由于项目以及学习需要，最近安装了MariaDB，把安装过程及遇到的坑记录下。</p>

<p><img src="https://i.loli.net/2018/07/11/5b45e5daa1914.png" alt="在Windows上运行Linux.png" /><!--删除链接：https://sm.ms/delete/4DBvj6ZL39XcprH --></p>

<h3 id="一mariadb简介">一、MariaDB简介</h3>
<h4 id="引用百度百科及其他相关资料">引用百度百科及其他相关资料:</h4>
<blockquote>
  <p>MariaDB数据库管理系统是MySQL的一个分支，主要由开源社区在维护，采用GPL授权许可。MariaDB的目的是完全兼容MySQL，包括API和命令行，使之能轻松成为MySQL的代替品。在存储引擎方面，使用XtraDB（英语：XtraDB）来代替MySQL的InnoDB。MariaDB由MySQL的创始人Michael Widenius主导开发，他早前曾以10亿美元的价格，将自己创建的公司MySQL AB卖给了SUN，此后，随着SUN被甲骨文收购，MySQL的所有权也落入Oracle的手中。MariaDB名称来自Michael Widenius的女儿Maria的名字。MySQL之父Widenius先生离开了Sun之后，觉得依靠Sun/Oracle来发展MySQL，实在很不靠谱（<strong>有闭源风险</strong>），于是决定重新开发代码全部开源且免费的关系型数据库，这就是MariaDB的由来。</p>
</blockquote>

<p>  目前Debian的软件源里已经由MariaDB来代替MySQL，我们要使用MySQL的话安装MariaDB即可。</p>
<h3 id="二安装mariadb">二、安装MariaDB</h3>
<p>  同安装其他软件一样两行代码（甚至与安装MySQL的方式类似）：</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt-get update
sudo apt-get install mariadb-server
</code></pre></div></div>
<h3 id="三启动mariadb服务">三、启动MariaDB服务</h3>
<p>  这里需要使用MySQL的命令，而且要在root权限之下：<code class="highlighter-rouge">sudo service mysql start</code>（启动服务）或者<code class="highlighter-rouge">sudo service mysql restart</code>（重启服务），如果不报错的话如下图：<br />
<img src="https://i.loli.net/2018/07/11/5b45ec9def61f.png" alt="启动MariaDB服务.png" /><!--删除连接：https://sm.ms/delete/ZYFCXrbGNDz7BOn--><br />
  此时我们可以输入<code class="highlighter-rouge">sudo service mysql status</code>来查看是否成功启动，如果成功启动：<br />
<img src="https://i.loli.net/2018/07/11/5b45ed228ecf6.png" alt="成功启动MariaDB服务.png" /><!--删除链接：https://sm.ms/delete/cSoPkqwEpIsLeFx-->  <br />
  如果未能成功启动是这样的：<br />
<img src="https://i.loli.net/2018/07/11/5b45ed73b91c3.png" alt="未能成功启动MariaDB服务.png" /><!--删除链接：https://sm.ms/delete/SX8tm6hfnc9yJP1--><br />
  如果没成功启动，那就需要再试试前面的命令，以及根据相应报错查阅资料再进行处理了，这里如果按照上文所说操作应该不会有任何问题。</p>
<h3 id="四在终端启动mariadb命令行并创建数据库testdb进行测试">四、在终端启动MariaDB命令行并创建数据库TESTDB进行测试</h3>
<p>1、 输入<code class="highlighter-rouge">sudo mysql -u root -p</code>然后输入root账户的密码（未启用root账户的话是sudo超级管理员密码）启动MariaDB命令行（<strong>注意，一定要在服务启动的情况下输入本命令，不然会报错<code class="highlighter-rouge">Can't connect to local MySQL server through socket '/var/run/mysqld/mysqld.sock' </code>只有MariaDB服务在运行的时候，才会有mysqld.sock这个文件存在</strong>）:<br />
<img src="https://i.loli.net/2018/07/11/5b45eff246adb.png" alt="成功启动MariaDB命令行.png" /><!--删除连接：https://sm.ms/delete/odzCeuyKXHFTIs3-->
2、 输入SQL语句<code class="highlighter-rouge">CREATE DATABASE TESTDB</code>来创建数据库<code class="highlighter-rouge">TESTDB</code>，并测试：<br />
<img src="https://i.loli.net/2018/07/11/5b45f2a366728.png" alt="成功添加数据库跟数据表.png" /><!--删除链接：https://sm.ms/delete/6xu21OWpQNHmdSk--><br />
  如果跟我的运行结果一样，那说明成功了，下面就是用其他程序连接并驱动数据库了。</p>
<h3 id="五使用pymysql连接mariadb数据库">五、使用pymysql连接MariaDB数据库</h3>
<p>1、 首先需要安装pymysql，代码是<code class="highlighter-rouge">sudo pip3 install pymysql</code>;<br />
2、 连接数据库，我们在这里使用了预先写好的代码：</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
# -*- coding: utf-8 -*-
</span>
<span class="s">' 学习MariaDB数据库 '</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s">'fslong'</span>

<span class="kn">import</span> <span class="nn">pymysql</span>
<span class="c1"># 打开数据库链接：
</span><span class="n">db</span> <span class="o">=</span> <span class="n">pymysql</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s">'127.0.0.1'</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">3306</span><span class="p">,</span>
                     <span class="n">user</span><span class="o">=</span><span class="s">'root'</span><span class="p">,</span> <span class="n">passwd</span><span class="o">=</span><span class="s">'passwd'</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="s">'TESTDB'</span><span class="p">)</span>
<span class="c1"># 建立游标：
</span><span class="n">cursor</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<span class="c1"># 预设sql语句：
</span><span class="n">sql</span> <span class="o">=</span> <span class="s">"""CREATE TABLE EMPLOYEE (
        FIRST_NAME CHAR(20) NOT NULL,
        LAST_NAME CHAR(20),
        AGE INT,
        SEX CHAR(1),
        INCOME FLOAT,
        PRIMARY KEY (FIRST_NAME))ENGINE=InnoDB DEFAULT CHARSET=utf8;"""</span>
<span class="c1"># 使用execute()驱动数据库并执行语句：
</span><span class="k">try</span><span class="p">:</span>
    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
    <span class="c1"># 提交到数据库执行：
</span>    <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="k">except</span><span class="p">:</span>
    <span class="c1"># 如果发生错误则回滚：
</span>    <span class="n">db</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
<span class="c1"># 关闭数据库链接：
</span><span class="n">db</span><span class="o">.</span><span class="n">close</span>

</code></pre></div></div>
<p>3、 在终端中运行<code class="highlighter-rouge">sudo python3 testDB.py</code>，不出意外的话会出错：<br />
<img src="https://i.loli.net/2018/07/11/5b45f4b283524.png" alt="pymysql连接MariaDB出错.png" /><!--删除连接：https://sm.ms/delete/513kyeJIOTuQhGj--><br />
  这里是localhost端口权限问题导致的报错，我们回到MariaDB命令行终端使用<code class="highlighter-rouge">grant</code>授权命令给予权限即可，完整代码<code class="highlighter-rouge">grant all on TESTDB.* to root@localhost identified by “passwd″;</code>（grant 后面的all指的是增删改查所有命令，你也可以只给部分权限，详细资料请看参考文献）然后再执行Python代码，之后我们查看下tables，一切正常，如下：</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MariaDB [TESTDB]&gt; SHOW TABLES;
+------------------+
| Tables_in_TESTDB |
+------------------+
| EMPLOYEE         |
| test1            |
+------------------+
2 rows in set (0.00 sec)
</code></pre></div></div>
<p>4、 我们尝试使用pymysql插入数据，这次我们再封装个类专门用于执行mysql语句（比较原始的类）：</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
# -*- coding: utf-8 -*-
</span>
<span class="s">' 学习MariaDB数据库 '</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s">'fslong'</span>

<span class="kn">import</span> <span class="nn">pymysql</span>


<span class="k">class</span> <span class="nc">MySQLConnection</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s">'127.0.0.1'</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">3306</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="s">'root'</span><span class="p">,</span> <span class="n">passwd</span><span class="o">=</span><span class="s">'passwd'</span><span class="p">,</span> <span class="n">dbName</span><span class="o">=</span><span class="s">'TESTDB'</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="n">host</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="n">port</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user</span> <span class="o">=</span> <span class="n">user</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">passwd</span> <span class="o">=</span> <span class="n">passwd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dbName</span> <span class="o">=</span> <span class="n">dbName</span>

    <span class="k">def</span> <span class="nf">executeSQL</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sql</span><span class="o">=</span><span class="s">''</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">sql</span> <span class="o">==</span> <span class="s">''</span><span class="p">:</span>
            <span class="c1"># 预设sql语句：
</span>            <span class="n">sql</span> <span class="o">=</span> <span class="s">"""CREATE TABLE IF NOT EXISTS `runoob_tbl`(
                `runoob_id` INT UNSIGNED AUTO_INCREMENT,
                `runoob_title` VARCHAR(100) NOT NULL,
                `runoob_author` VARCHAR(40) NOT NULL,
                `submission_date` DATE,
                PRIMARY KEY (`runoob_id`)
                )ENGINE=InnoDB DEFAULT CHARSET=utf8;"""</span>
        <span class="n">db</span> <span class="o">=</span> <span class="n">pymysql</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">,</span>
                             <span class="n">user</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="n">passwd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">passwd</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dbName</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="c1"># 使用execute()驱动数据库并执行语句：
</span>        <span class="k">try</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
            <span class="c1"># 提交到数据库执行：
</span>            <span class="n">db</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c1"># 如果发生错误则回滚：
</span>            <span class="n">db</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
        <span class="c1"># 关闭数据库链接：
</span>        <span class="n">db</span><span class="o">.</span><span class="n">close</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="n">MySQLConnection</span><span class="p">()</span>
    <span class="n">sql</span> <span class="o">=</span> <span class="s">"""INSERT INTO runoob_tbl(runoob_title, runoob_author, submission_date)
    	VALUES("学习 PHP", "菜鸟教程", NOW());"""</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">executeSQL</span><span class="p">(</span><span class="n">sql</span><span class="o">=</span><span class="n">sql</span><span class="p">)</span>
</code></pre></div></div>
<p>  执行两次后，回到MariaDB命令行终端查看：</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MariaDB [TESTDB]&gt; SHOW TABLES;
+------------------+
| Tables_in_TESTDB |
+------------------+
| EMPLOYEE         |
| runoob_tbl       |
| test1            |
+------------------+
3 rows in set (0.00 sec)

MariaDB [TESTDB]&gt; SELECT * FROM runoob_tbl;
+-----------+--------------+---------------+-----------------+
| runoob_id | runoob_title | runoob_author | submission_date |
+-----------+--------------+---------------+-----------------+
|         1 | 学习 PHP     | 菜鸟教程      | 2018-07-11      |
|         2 | 学习 PHP     | 菜鸟教程      | 2018-07-11      |
+-----------+--------------+---------------+-----------------+
2 rows in set (0.00 sec)

MariaDB [TESTDB]&gt; 
</code></pre></div></div>
<p>  运行正常，以后就可以愉快的玩耍了，上面用pymysql连接MariaDB的代码注释已经比较清楚，主要思路是：<code class="highlighter-rouge">建立连接→建立游标→执行语句→提交更改→关闭连接释放游标</code>，也算是ORM的雏形，以后我们可以在此基础上拓展功能。最后，感谢群里帮助过我的小伙伴，感谢参考文献，感谢关注。</p>

<hr />

<h4 id="参考文献"><em>参考文献</em></h4>
<blockquote>
  <p>1、<a href="http://www.runoob.com/python3/python3-mysql.html">Python3 MySQL 数据库连接</a><br />
2、<a href="https://blog.csdn.net/lampsunny/article/details/7410657">Mysql中grant命令详解</a></p>
</blockquote>
