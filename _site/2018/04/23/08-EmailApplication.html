<p>  本文是根据廖雪峰老师博客所讲的Python教程里的有关电子邮件内容进行了一定的修改整合编写的一套客户端，主要是辅助自己对这块知识更加理解，并编写成了一个类（以后如果需要其实是可以直接调用的），另外就是记录下在编写过程中遇到的坑！<br />
  其实用Python收发邮件跟我们平时收发邮件逻辑上是一样的（这里就不说那么多深层次原理各位可以参考廖老师博客），<strong>发送邮件的时候</strong>：</p>
<ol>
  <li>连接邮箱提供商的smtp服务，建立好一个server（相当于登陆邮箱网页并选择自己是126邮箱还是163邮箱），这里需要注意目前邮箱都是要采用加密的，如果采用的是STARTTLS加密模式（outlook等邮箱）需要执行：
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">server</span> <span class="o">=</span> <span class="n">smtplib</span><span class="o">.</span><span class="n">SMTP</span><span class="p">(</span><span class="n">smtpAddress</span><span class="p">,</span> <span class="n">smtpPort</span><span class="p">)</span> 
 <span class="n">server</span><span class="o">.</span><span class="n">starttls</span><span class="p">()</span>
</code></pre></div>    </div>
    <p>  如果采用的是SSL方式加密（163、qq等邮箱）需要执行：<code class="highlighter-rouge">server = smtplib.SMTP_SSL(smtpAddress, smtpPort)</code>来建立服务，这两种是不一样的，需要去邮箱服务商官网上查看！</p>
  </li>
  <li>登录邮箱：<code class="highlighter-rouge">server.login(addr, passwd)</code>；</li>
  <li>编辑邮件（我们也可以事先就把邮件编辑好然后再登陆），我直接写了一个editEmail的方法，在此处调用就好；</li>
  <li>输入收件人地址；</li>
  <li>
    <h2 id="发送邮件serversendmailaddr-selfmailto-selfmsgas_string">发送邮件<code class="highlighter-rouge">server.sendmail(addr, self.mailTo, self.msg.as_string())</code>。</h2>
    <p>执行一下看看发送邮件的结果：<br />
<img src="http://wx3.sinaimg.cn/mw1024/3c1b9c69ly1fqmlfxr948j20ih0gpq3m.jpg" alt="发送邮件1" /><br />
发送完去邮箱里就可以看到刚刚发的邮件：<br />
<img src="http://wx1.sinaimg.cn/large/3c1b9c69ly1fqmlg11797j20hj0gdabt.jpg" alt="发送邮件2" /></p>
  </li>
</ol>

<!-- more -->
<p>  看吧，跟平时在网页上发送邮件的逻辑、步骤是一样一样的，<strong>收邮件的时候呢</strong>：</p>
<ol>
  <li>跟smtp类似，首先建立pop3网络服务：<code class="highlighter-rouge">server = poplib.POP3_SSL(pop3Addres, pop3Port)</code>，这里需要使用SSL加密协议（目前大部分pop3服务都已经使用SSL加密协议，不使用加密会被拒绝登陆）；</li>
  <li>身份认证，这里需要两句代码：<code class="highlighter-rouge">server.user(userAddress)</code>和<code class="highlighter-rouge">server.pass_(password)</code>，也就是输入用户名和密码，提交了这两个数据就login上了；</li>
  <li>可以使用<code class="highlighter-rouge">server.list()</code>函数来获取收件箱列表，返回值是一个tuple，第二个参数是收件箱的所有邮件的编号，类似于<code class="highlighter-rouge">[b'1 82923', b'2 2184', ...]</code>这样的数据，这其实是邮件的索引，’后跟的第一个数字为该邮件的索引，我们可以使用这个数字来读取这封邮件；</li>
  <li>下载邮件，此时已经建立好了连接，我们就可以反复调用<code class="highlighter-rouge">server.retr(i)</code>来获取邮件的内容，返回值也是一个tuple，第二个参数是邮件所有内容，包括header、subject、content等，但此时获取到的数据是二进制数据需要进行解析；</li>
  <li>我们可以使用email.parser模块里面的一些方法，对收取到的邮件进行解析！</li>
</ol>

<p>我们执行一下代码：<br />
<img src="http://wx2.sinaimg.cn/mw690/3c1b9c69ly1fqmlg8ozp5j20lt0hn3zy.jpg" alt="收取邮件1" />
<img src="http://wx4.sinaimg.cn/mw690/3c1b9c69ly1fqmlg8qe8cj20u90hlmxz.jpg" alt="收取邮件2" /><br />
下面上代码：</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
# -*- coding: utf-8 -*-
</span><span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">poplib</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">smtplib</span>
<span class="kn">import</span> <span class="nn">chardet</span>
<span class="kn">from</span> <span class="nn">email</span> <span class="kn">import</span> <span class="n">encoders</span>
<span class="kn">from</span> <span class="nn">email.header</span> <span class="kn">import</span> <span class="n">Header</span><span class="p">,</span> <span class="n">decode_header</span>
<span class="kn">from</span> <span class="nn">email.mime.multipart</span> <span class="kn">import</span> <span class="n">MIMEBase</span><span class="p">,</span> <span class="n">MIMEMultipart</span>
<span class="kn">from</span> <span class="nn">email.mime.text</span> <span class="kn">import</span> <span class="n">MIMEText</span>
<span class="kn">from</span> <span class="nn">email.parser</span> <span class="kn">import</span> <span class="n">Parser</span>
<span class="kn">from</span> <span class="nn">email.utils</span> <span class="kn">import</span> <span class="n">formataddr</span><span class="p">,</span> <span class="n">parseaddr</span>

<span class="c1">#############################################################################
# 本客户端提供最简单的邮件收发功能，并可以简单加密保存账户信息到本地，方便第二次登陆
#############################################################################
# 默认未添加任何邮箱服务商的smtp服务器及pop3服务器信息，但你添加过一次之后就会保存
#############################################################################
</span>

<span class="c1">#############################################################################
#                    本程序是前面写的程序的改写，改成面向对象的
#############################################################################
# 声明一个表示邮箱账户信息的类
</span><span class="k">class</span> <span class="nc">MyEmail</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="c1"># 声明这个类的属性，包括账户密码信息，pop3和smtp服务器，所有账户信息
</span>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">users</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">smtp</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop3</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selfPassWord</span> <span class="o">=</span> <span class="s">''</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tempSelfPassWord</span> <span class="o">=</span> <span class="s">''</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">MIMEMultipart</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mailTo</span> <span class="o">=</span> <span class="s">''</span>

    <span class="c1"># 添加账户信息
</span>    <span class="k">def</span> <span class="nf">updateAccounts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span><span class="p">[</span><span class="s">'users'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span><span class="p">[</span><span class="s">'smtp'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">smtp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span><span class="p">[</span><span class="s">'pop3'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accounts</span><span class="p">[</span><span class="s">'selfPassWord'</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">selfPassWord</span>

    <span class="k">def</span> <span class="nf">calculateHash</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">()</span>
        <span class="n">a</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">a</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
    <span class="c1"># 检测个人密钥
</span>
    <span class="k">def</span> <span class="nf">checkSelfPassword</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="n">selfPassWord</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'请输入个人密钥用于解密：'</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculateHash</span><span class="p">(</span><span class="n">selfPassWord</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="n">b</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="n">selfPassWord</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span>

    <span class="c1"># 对密码加密（超级简陋的算法）：
</span>    <span class="k">def</span> <span class="nf">encipherData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">passwd</span><span class="p">,</span> <span class="n">selfPassWord</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">passwd</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">selfPassWord</span><span class="p">)</span>
        <span class="n">passwd</span> <span class="o">=</span> <span class="n">passwd</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">selfPassWord</span> <span class="o">+</span> <span class="n">passwd</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">passwd</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">passwd</span>

    <span class="c1"># 对密码解密（超级简陋的算法）：
</span>    <span class="k">def</span> <span class="nf">decryptData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">passwd</span><span class="p">,</span> <span class="n">selfPassWord</span><span class="p">):</span>
        <span class="n">decryptedPasswd</span> <span class="o">=</span> <span class="s">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">passwd</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">selfPassWord</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">decryptedPasswd</span>

    <span class="c1">########################################################################################################
</span>    <span class="c1"># 下面是有关发送邮件的方法################################################################################
</span>    <span class="c1">########################################################################################################
</span>
    <span class="k">def</span> <span class="nf">editEmail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">_formata_addr</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">addr</span> <span class="o">=</span> <span class="n">parseaddr</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">formataddr</span><span class="p">((</span><span class="n">Header</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s">'utf-8'</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">addr</span><span class="p">))</span>
        <span class="c1"># 输入收件人地址：
</span>        <span class="n">mailTo</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'请输入收件人地址：'</span><span class="p">)</span>
        <span class="c1"># 自定义邮件发送者名称（如果在地址簿中设置了备注，那就不显示）:
</span>        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">[</span><span class="s">'From'</span><span class="p">]</span> <span class="o">=</span> <span class="n">_formata_addr</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span>
        <span class="c1"># 自定义收件人名称，接收的是字符串而不是list，如果有多个邮件地址，用,分隔即可（如果在地址簿中设置了备注，那就不显示）：
</span>        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">[</span><span class="s">'To'</span><span class="p">]</span> <span class="o">=</span> <span class="n">_formata_addr</span><span class="p">(</span><span class="n">mailTo</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mailTo</span> <span class="o">=</span> <span class="n">mailTo</span>
        <span class="c1"># 主题包含中文，所以需要用header格式化一下，主题用Header格式化，address用_formata_addr格式化：
</span>
        <span class="k">def</span> <span class="nf">subjectOfMail</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">subject</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'请输入邮件主题：</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">subject</span> <span class="o">==</span> <span class="s">''</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">'必须输入主题：'</span><span class="p">)</span>
                <span class="n">subjectOfMail</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">subject</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">[</span><span class="s">'Subject'</span><span class="p">]</span> <span class="o">=</span> <span class="n">Header</span><span class="p">(</span><span class="n">subjectOfMail</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="s">'utf-8'</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">attachFile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="c1"># 添加附件
</span>            <span class="c1"># 需要把附件转为MIMEBase对象添加上
</span>            <span class="c1"># 先从本地打开一个文件：
</span>            <span class="n">a</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'请将文件放到本程序工作目录下，并输入文件名：</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s">'打开附件测试成功，可以发送！'</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="c1"># 获取后缀名
</span>                <span class="n">i</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">'.'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s">'rb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="c1"># 设置附件的MIME和文件名，这里是jpg类型(第一个参数其实可以随便):
</span>                    <span class="n">mime</span> <span class="o">=</span> <span class="n">MIMEBase</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                    <span class="c1"># 加上必要的头信息，比如content ID回头可以用于在邮件正文中引用
</span>                    <span class="c1"># 类型为附件，名称是之前设置过的名称:
</span>                    <span class="n">mime</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span>
                        <span class="s">'Content-Disposition'</span><span class="p">,</span> <span class="s">'attachment'</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">a</span><span class="p">)</span>
                    <span class="c1"># 设置ID用于引用等：
</span>                    <span class="n">mime</span><span class="o">.</span><span class="n">add_header</span><span class="p">(</span><span class="s">'Content-ID'</span><span class="p">,</span>
                                    <span class="s">'&lt;'</span> <span class="o">+</span> <span class="nb">input</span><span class="p">(</span><span class="s">'请输入引用时用的id：</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span> <span class="o">+</span> <span class="s">'&gt;'</span><span class="p">)</span>
                    <span class="c1">#mime.add_header('X-Attachment-Id', '0')
</span>                    <span class="c1"># 读取附件并天骄到mime当中:
</span>                    <span class="n">mime</span><span class="o">.</span><span class="n">set_payload</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
                    <span class="c1"># 将mime使用base64编码
</span>                    <span class="n">encoders</span><span class="o">.</span><span class="n">encode_base64</span><span class="p">(</span><span class="n">mime</span><span class="p">)</span>
                    <span class="c1"># 添加到MIMEMultipart,往MIMEMultipart添加除Header以外的内容都需要用attach():
</span>                    <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="n">mime</span><span class="p">)</span>
                <span class="n">a</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'是否继续编辑邮件？y/n</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="s">'y'</span><span class="p">:</span>
                    <span class="n">chooseContentFunction</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">'打开附件失败，请重新添加附件!'</span><span class="p">)</span>
                <span class="n">attachFile</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c1"># 增加一个邮件正文内容：
</span>        <span class="c1"># 如果把上面的附件，比如上面的照片以html的方法插入到了正文中，将不会在附件中显示
</span>        <span class="k">def</span> <span class="nf">attachText</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">a</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'纯文本格式请按0，html格式请按1：'</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">a</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="s">'html'</span><span class="p">,</span> <span class="s">'plain'</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span>
                <span class="n">MIMEText</span><span class="p">(</span>
                    <span class="nb">input</span><span class="p">(</span><span class="s">'请输入文件正文:</span><span class="se">\n</span><span class="s">'</span><span class="p">),</span> <span class="n">b</span><span class="p">[</span><span class="n">a</span><span class="p">],</span>
                    <span class="s">'utf-8'</span><span class="p">))</span>  <span class="c1"># 邮件文本
</span>            <span class="n">a</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'是否继续编辑邮件？y/n</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="s">'y'</span><span class="p">:</span>
                <span class="n">chooseContentFunction</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="c1"># 选择添加什么内容的函数
</span>        <span class="k">def</span> <span class="nf">chooseContentFunction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">chooseContent</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'编辑正文请按0，添加附件请按1，退出请按e:</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">chooseContent</span> <span class="o">==</span> <span class="s">'0'</span><span class="p">:</span>
                <span class="n">attachText</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">chooseContent</span> <span class="o">==</span> <span class="s">'1'</span><span class="p">:</span>
                <span class="n">attachFile</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">chooseContent</span> <span class="o">==</span> <span class="s">'e'</span><span class="p">:</span>
                <span class="nb">exit</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">chooseFunction</span><span class="p">()</span>
        <span class="n">chooseContentFunction</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">sendEmailBySmtp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">passwd</span><span class="p">,</span> <span class="n">smtp</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">smtp</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s">'0'</span><span class="p">:</span>
                <span class="n">server</span> <span class="o">=</span> <span class="n">smtplib</span><span class="o">.</span><span class="n">SMTP_SSL</span><span class="p">(</span><span class="n">smtp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">smtp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">server</span> <span class="o">=</span> <span class="n">smtplib</span><span class="o">.</span><span class="n">SMTP</span><span class="p">(</span><span class="n">smtp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">smtp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">print</span><span class="p">(</span><span class="n">smtp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">smtp</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">server</span><span class="o">.</span><span class="n">starttls</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'建立发送邮件服务失败，请重试！'</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">server</span><span class="p">:</span>
                <span class="c1"># 打印调试信息
</span>                <span class="c1">#server.set_debuglevel(1)
</span>                <span class="k">print</span><span class="p">(</span><span class="s">'建立发送邮件服务成功，开始尝试登陆smtp服务器...'</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">server</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">passwd</span><span class="p">)</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">'smtp服务器登陆成功，开始尝试发送邮件...'</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="c1"># 发送邮件的时候需要设置msg.as_string()
</span>                        <span class="n">server</span><span class="o">.</span><span class="n">sendmail</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mailTo</span><span class="p">,</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="o">.</span><span class="n">as_string</span><span class="p">())</span>
                        <span class="k">print</span><span class="p">(</span><span class="s">'邮件发送成功'</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">print</span><span class="p">(</span><span class="s">'邮件发送失败，请重试！'</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">'登陆发送服务器失败，请重试！'</span><span class="p">)</span>
    <span class="c1">########################################################################################################
</span>    <span class="c1"># 下面是有关接收邮件的方法################################################################################
</span>    <span class="c1">########################################################################################################
</span>    <span class="c1"># 邮件的Subject或者Email中包含的名字都是经过编码后的str，要正常显示，就必须decode：
</span>
    <span class="k">def</span> <span class="nf">decode_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="n">value</span><span class="p">,</span> <span class="n">charset</span> <span class="o">=</span> <span class="n">decode_header</span><span class="p">(</span><span class="n">s</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">charset</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">charset</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="c1"># 猜一下邮件文本的编码，其实直接导入chardet，就不用了
</span>    <span class="k">def</span> <span class="nf">guess_charset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="n">charset</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_charset</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">charset</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">content_type</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'Content-Type'</span><span class="p">,</span> <span class="s">''</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">content_type</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">'charset='</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">charset</span> <span class="o">=</span> <span class="n">content_type</span><span class="p">[</span><span class="n">pos</span> <span class="o">+</span> <span class="mi">8</span><span class="p">:]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">charset</span>

    <span class="k">def</span> <span class="nf">parseMail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="c1"># Message对象本身可能是一个MIMEMultipart对象，即包含嵌套的其他MIMEBase对象，嵌套可能还不止一层。
</span>        <span class="c1"># 所以我们要递归地打印出Message对象的层次结构：
</span>        <span class="c1"># indent用于显示缩进：
</span>        <span class="k">if</span> <span class="n">indent</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># 获取不同的header的数据：
</span>            <span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="p">[</span><span class="s">'From'</span><span class="p">,</span> <span class="s">'To'</span><span class="p">,</span> <span class="s">'Subject'</span><span class="p">]:</span>
                <span class="c1"># 如果header的值是Sbject就解析成主题，使用decode_header来解析(可能存在汉字)
</span>                <span class="c1"># 如果不是那一定是发件人或者收件人的地址了，那么就使用parseaddr来解析
</span>                <span class="n">value</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="s">''</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">header</span> <span class="o">==</span> <span class="s">'Subject'</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decode_str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">hdr</span><span class="p">,</span> <span class="n">addr</span> <span class="o">=</span> <span class="n">parseaddr</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                        <span class="c1"># 发件人名称有可能也是中文，所有也要用decode_str()方法来decode
</span>                        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decode_str</span><span class="p">(</span><span class="n">hdr</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">'Frmo'</span><span class="p">:</span>
                            <span class="n">name</span> <span class="o">=</span> <span class="s">'来自'</span>
                        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">'To'</span><span class="p">:</span>
                            <span class="n">name</span> <span class="o">=</span> <span class="s">'收件人'</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="s">u'</span><span class="si">%</span><span class="s">s &lt;</span><span class="si">%</span><span class="s">s&gt;'</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">addr</span><span class="p">)</span>
                        <span class="k">print</span><span class="p">(</span><span class="s">'</span><span class="si">%</span><span class="s">s:</span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span> <span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'------------------------------------------------------------'</span><span class="p">)</span>
        <span class="c1"># 如果msg包含附件：
</span>        <span class="k">if</span> <span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">is_multipart</span><span class="p">()):</span>
            <span class="c1"># 通过观察multipart各个参数的以及对象的数值，发现所有的正文信息都存在payload对象里，所以获取了他并进行分析
</span>            <span class="n">parts</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">part</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">parts</span><span class="p">):</span>
                <span class="k">print</span><span class="p">(</span>
                    <span class="s">'------------------------------------------------------------'</span>
                <span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s">'</span><span class="si">%</span><span class="s">s&lt;第</span><span class="si">%</span><span class="s">s部分&gt;：'</span> <span class="o">%</span> <span class="p">(</span><span class="s">'  '</span> <span class="o">%</span> <span class="n">indent</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
                <span class="k">print</span><span class="p">(</span>
                    <span class="s">'</span><span class="si">%</span><span class="s">s------------------------------------------------------------'</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="s">'  '</span><span class="o">*</span><span class="n">indent</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parseMail</span><span class="p">(</span><span class="n">part</span><span class="p">,</span> <span class="n">indent</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">content_type</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_content_type</span><span class="p">()</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get_payload</span><span class="p">(</span><span class="n">decode</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">chardet</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span><span class="n">content</span><span class="p">)[</span><span class="s">'encoding'</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">content_type</span> <span class="o">==</span> <span class="s">'text/plain'</span> <span class="ow">or</span> <span class="n">content_type</span> <span class="o">==</span> <span class="s">'text/html'</span><span class="p">:</span>
                <span class="c1">#charset = self.guess_charset(msg)
</span>                <span class="c1"># 如果猜出来编码，那就decode成那个编码，其实可以直接chardet：
</span>                <span class="s">'''
                if charset:
                    content = content.decode(charset)
                '''</span>
                <span class="k">print</span><span class="p">(</span><span class="s">'</span><span class="si">%</span><span class="s">s&lt;文本&gt;:</span><span class="se">\n</span><span class="s">------------------------------------------------------------</span><span class="se">\n</span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span>
                      <span class="p">((</span><span class="s">'  '</span> <span class="o">*</span> <span class="n">indent</span><span class="p">),</span> <span class="n">content</span> <span class="o">+</span> <span class="s">'...'</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">'</span><span class="si">%</span><span class="s">s&lt;Attachment&gt;: </span><span class="si">%</span><span class="s">s/n</span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span>
                      <span class="p">((</span><span class="s">'  '</span> <span class="o">*</span> <span class="n">indent</span><span class="p">),</span> <span class="n">content_type</span><span class="p">,</span> <span class="n">content</span><span class="p">))</span>

    <span class="c1"># 打印邮件标题的函数
</span>    <span class="k">def</span> <span class="nf">mailHeader</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">startNum</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">server</span><span class="p">):</span>
        <span class="k">while</span> <span class="n">startNum</span> <span class="o">&gt;</span> <span class="n">num</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">retr</span><span class="p">(</span><span class="n">startNum</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">msgContent</span> <span class="o">=</span> <span class="n">b</span><span class="s">'</span><span class="se">\r\n</span><span class="s">'</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span>
            <span class="c1"># Parser()是创立的解析对象，下一步其实是将两部连在一起，先创立一个解析对象，然后再使用Parser类的parsestr()方法解析，返回值是解析完的数据
</span>            <span class="n">msg</span> <span class="o">=</span> <span class="n">Parser</span><span class="p">()</span><span class="o">.</span><span class="n">parsestr</span><span class="p">(</span><span class="n">msgContent</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'Subject'</span><span class="p">,</span> <span class="s">''</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decode_str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">startNum</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'</span><span class="si">%</span><span class="s">s、</span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span> <span class="p">(</span><span class="n">startNum</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>


<span class="c1"># 设置邮箱账号密码的函数
</span><span class="k">def</span> <span class="nf">setAccounts</span><span class="p">(</span><span class="n">myEmail</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'pyEmail'</span><span class="p">,</span> <span class="s">'wb'</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'文件打开失败，请检查本程序工作目录下的"pyEmail"文件是否占用后重试！</span><span class="se">\n</span><span class="s">是否重试建立账户？y/n:'</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="s">'y'</span><span class="p">:</span>
            <span class="n">setAccounts</span><span class="p">(</span><span class="n">myEmail</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">exit</span><span class="p">()</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">selfPassWord</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'首次登陆，新建个人密钥：'</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'请输入你要登陆的邮箱地址：'</span><span class="p">)</span>
            <span class="n">j</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'请输入你要登陆的邮箱密码：'</span><span class="p">)</span>
            <span class="n">k</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'请按smtp.example.com:port格式输入smtp服务器及端口：'</span><span class="p">)</span>
            <span class="n">m</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'smtp服务器采用SSL加密请按0，STARTTLS加密请按1:'</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">m</span> <span class="o">==</span> <span class="s">'1'</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="s">'1'</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">==</span> <span class="s">'0'</span>
            <span class="n">l</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'请按pop.example.com:port格式输入pop3服务器及端口：'</span><span class="p">)</span>
            <span class="n">myEmail</span><span class="o">.</span><span class="n">selfPassWord</span> <span class="o">=</span> <span class="n">myEmail</span><span class="o">.</span><span class="n">calculateHash</span><span class="p">(</span><span class="n">selfPassWord</span><span class="p">)</span>
            <span class="n">myEmail</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">myEmail</span><span class="o">.</span><span class="n">encipherData</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">selfPassWord</span><span class="p">)))</span>
            <span class="n">myEmail</span><span class="o">.</span><span class="n">smtp</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">'@'</span><span class="p">)[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">':'</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">':'</span><span class="p">)[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">m</span><span class="p">)</span>
            <span class="n">myEmail</span><span class="o">.</span><span class="n">pop3</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">'@'</span><span class="p">)[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">l</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">':'</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">':'</span><span class="p">)[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">myEmail</span><span class="o">.</span><span class="n">updateAccounts</span><span class="p">()</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'pyEmail'</span><span class="p">,</span> <span class="s">'wb'</span><span class="p">)</span><span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">myEmail</span><span class="o">.</span><span class="n">accounts</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'新账号设置完毕：'</span><span class="p">)</span>
            <span class="n">chooseFunction</span><span class="p">()</span>

<span class="c1"># 读取邮箱账号密码的函数
</span>

<span class="k">def</span> <span class="nf">readAccounts</span><span class="p">(</span><span class="n">myEmail</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">'pyEmail'</span><span class="p">,</span> <span class="s">'rb'</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'本地数据读取成功，开始解析...'</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'本地数据读取失败，开始新建账户信息数据库...'</span><span class="p">)</span>
        <span class="n">setAccounts</span><span class="p">(</span><span class="n">myEmail</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">text</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">readAccounts</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'本地数据解析成功，开始解密...'</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'本地数据解析失败，请重试！'</span><span class="p">)</span>
            <span class="n">chooseFunction</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">readAccounts</span> <span class="o">==</span> <span class="s">''</span><span class="p">:</span>
            <span class="n">checked</span> <span class="o">=</span> <span class="n">myEmail</span><span class="o">.</span><span class="n">checkSelfPassword</span><span class="p">(</span>
                <span class="n">readAccounts</span><span class="p">[</span><span class="s">'selfPassWord'</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">checked</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">'个人密钥验证成功，本地保存的账户有:'</span><span class="p">)</span>
                <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">readAccounts</span><span class="p">[</span><span class="s">'users'</span><span class="p">]:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">'第</span><span class="si">%</span><span class="s">s个账户：</span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">myEmail</span><span class="o">.</span><span class="n">accounts</span> <span class="o">=</span> <span class="n">readAccounts</span>
                <span class="n">myEmail</span><span class="o">.</span><span class="n">selfPassWord</span> <span class="o">=</span> <span class="n">readAccounts</span><span class="p">[</span><span class="s">'selfPassWord'</span><span class="p">]</span>
                <span class="n">myEmail</span><span class="o">.</span><span class="n">users</span> <span class="o">=</span> <span class="n">readAccounts</span><span class="p">[</span><span class="s">'users'</span><span class="p">]</span>
                <span class="n">myEmail</span><span class="o">.</span><span class="n">smtp</span> <span class="o">=</span> <span class="n">readAccounts</span><span class="p">[</span><span class="s">'smtp'</span><span class="p">]</span>
                <span class="n">myEmail</span><span class="o">.</span><span class="n">pop3</span> <span class="o">=</span> <span class="n">readAccounts</span><span class="p">[</span><span class="s">'pop3'</span><span class="p">]</span>
                <span class="n">myEmail</span><span class="o">.</span><span class="n">tempSelfPassWord</span> <span class="o">=</span> <span class="n">checked</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">'个人密钥错误，解密失败！'</span><span class="p">)</span>
                <span class="n">readAccounts</span><span class="p">(</span><span class="n">myEmail</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'本地数据为空，开始新建账户信息数据库...'</span><span class="p">)</span>
            <span class="n">setAccounts</span><span class="p">(</span><span class="n">myEmail</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'本地数据为空，开始新建账户信息数据库...'</span><span class="p">)</span>
        <span class="n">setAccounts</span><span class="p">(</span><span class="n">myEmail</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">chooseFunction</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'------------------------------------------------------------'</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'欢迎使用我的邮箱客户端！'</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'------------------------------------------------------------'</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'发邮件还是收邮件抑或是退出？s/g/e:</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="s">'s'</span><span class="p">:</span>
        <span class="n">sendEmail</span><span class="p">()</span>
        <span class="n">chooseFunction</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">a</span> <span class="o">==</span> <span class="s">'g'</span><span class="p">:</span>
        <span class="n">getEMail</span><span class="p">()</span>
        <span class="n">chooseFunction</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">a</span> <span class="o">==</span> <span class="s">'e'</span><span class="p">:</span>
        <span class="nb">exit</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">chooseFunction</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">sendEmail</span><span class="p">():</span>
    <span class="c1"># 新建Email类：
</span>    <span class="n">myEmail</span> <span class="o">=</span> <span class="n">MyEmail</span><span class="p">()</span>
    <span class="c1"># 实例化这个类：
</span>    <span class="n">readAccounts</span><span class="p">(</span><span class="n">myEmail</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'使用哪个邮箱(直接输入前面邮箱的序号即可，如果使用其他账户请不要输入任何数据)？</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r'^\d\d*'</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">myEmail</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'登陆账户为：</span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span> <span class="n">user</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">emailName</span> <span class="o">=</span> <span class="n">user</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">'@'</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">smtp</span> <span class="o">=</span> <span class="n">myEmail</span><span class="o">.</span><span class="n">smtp</span><span class="p">[</span><span class="n">emailName</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'未能查询到保存的smtp服务器信息，开始新建服务器信息：'</span><span class="p">)</span>
            <span class="n">smtp</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'请按smtp.example.com:port格式输入smtp服务器及端口：'</span><span class="p">)</span>
            <span class="n">m</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'smtp服务器采用SSL加密请按0，STARTTLS加密请按1:'</span><span class="p">)</span>
            <span class="n">myEmail</span><span class="o">.</span><span class="n">smtp</span><span class="p">[</span><span class="n">emailName</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">smtp</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">':'</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">(</span><span class="n">smtp</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">':'</span><span class="p">)[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">m</span><span class="p">)</span>
            <span class="n">myEmail</span><span class="o">.</span><span class="n">updateAccounts</span><span class="p">()</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'pyEmail'</span><span class="p">,</span> <span class="s">'wb'</span><span class="p">)</span><span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">myEmail</span><span class="o">.</span><span class="n">accounts</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'该账户smtp服务器为：</span><span class="si">%</span><span class="s">s:</span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span> <span class="p">(</span><span class="n">smtp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">smtp</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">addr</span> <span class="o">=</span> <span class="n">user</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">passwd</span> <span class="o">=</span> <span class="n">myEmail</span><span class="o">.</span><span class="n">decryptData</span><span class="p">(</span><span class="n">user</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">myEmail</span><span class="o">.</span><span class="n">tempSelfPassWord</span><span class="p">)</span>
        <span class="n">myEmail</span><span class="o">.</span><span class="n">editEmail</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span>
        <span class="n">myEmail</span><span class="o">.</span><span class="n">sendEmailBySmtp</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">passwd</span><span class="p">,</span> <span class="n">smtp</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="s">''</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'建立新的账户：'</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'为保证数据安全，再次验证个人密钥'</span><span class="p">)</span>
        <span class="n">checked</span> <span class="o">=</span> <span class="n">myEmail</span><span class="o">.</span><span class="n">checkSelfPassword</span><span class="p">(</span><span class="n">myEmail</span><span class="o">.</span><span class="n">selfPassWord</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">checked</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'个人密钥验证通过！'</span><span class="p">)</span>
            <span class="n">selfPassWord</span> <span class="o">=</span> <span class="n">checked</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">i</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'请输入你要登陆的邮箱地址：'</span><span class="p">)</span>
            <span class="n">j</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'请输入你要登陆的邮箱密码：'</span><span class="p">)</span>
            <span class="n">k</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'请按smtp.example.com:port格式输入smtp服务器及端口：'</span><span class="p">)</span>
            <span class="n">m</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'smtp服务器采用SSL加密请按0，STARTTLS加密请按1:'</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">m</span> <span class="o">==</span> <span class="s">'1'</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="s">'1'</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">==</span> <span class="s">'0'</span>
            <span class="n">l</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'请按pop.example.com:port格式输入pop3服务器及端口：'</span><span class="p">)</span>
            <span class="n">myEmail</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">myEmail</span><span class="o">.</span><span class="n">encipherData</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">selfPassWord</span><span class="p">)))</span>
            <span class="n">myEmail</span><span class="o">.</span><span class="n">smtp</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">'@'</span><span class="p">)[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">':'</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">':'</span><span class="p">)[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">m</span><span class="p">)</span>
            <span class="n">myEmail</span><span class="o">.</span><span class="n">pop3</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">'@'</span><span class="p">)[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">l</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">':'</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">':'</span><span class="p">)[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">myEmail</span><span class="o">.</span><span class="n">updateAccounts</span><span class="p">()</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'pyEmail'</span><span class="p">,</span> <span class="s">'wb'</span><span class="p">)</span><span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">myEmail</span><span class="o">.</span><span class="n">accounts</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'新账号设置完毕！'</span><span class="p">)</span>
            <span class="n">chooseFunction</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'个人密钥验证失败，请重试!'</span><span class="p">)</span>
            <span class="n">sendEmail</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'输入非法，请重试！'</span><span class="p">)</span>
        <span class="n">sendEmail</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">getEMail</span><span class="p">():</span>
    <span class="c1"># 新建Email类：
</span>    <span class="n">myEmail</span> <span class="o">=</span> <span class="n">MyEmail</span><span class="p">()</span>
    <span class="c1"># 实例化这个类：
</span>    <span class="n">readAccounts</span><span class="p">(</span><span class="n">myEmail</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'使用哪个邮箱(直接输入前面邮箱的序号即可，如果使用其他账户请不要输入任何数据)？</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r'^\d\d*'</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">myEmail</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'登陆账户为：</span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span> <span class="n">user</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">emailName</span> <span class="o">=</span> <span class="n">user</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">'@'</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pop3</span> <span class="o">=</span> <span class="n">myEmail</span><span class="o">.</span><span class="n">pop3</span><span class="p">[</span><span class="n">emailName</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'未能查询到保存的pop3服务器信息，开始新建服务器信息：'</span><span class="p">)</span>
            <span class="n">pop3</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'请按pop.example.com:port格式输入pop3服务器及端口：'</span><span class="p">)</span>
            <span class="n">myEmail</span><span class="o">.</span><span class="n">pop3</span><span class="p">[</span><span class="n">emailName</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">pop3</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">':'</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">(</span><span class="n">pop3</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">':'</span><span class="p">)[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">myEmail</span><span class="o">.</span><span class="n">updateAccounts</span><span class="p">()</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'pyEmail'</span><span class="p">,</span> <span class="s">'wb'</span><span class="p">)</span><span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">myEmail</span><span class="o">.</span><span class="n">accounts</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'该账户的pop3服务器为：</span><span class="si">%</span><span class="s">s:</span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span> <span class="p">(</span><span class="n">pop3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pop3</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="c1"># 连接pop3服务器
</span>        <span class="n">server</span> <span class="o">=</span> <span class="n">poplib</span><span class="o">.</span><span class="n">POP3_SSL</span><span class="p">(</span><span class="n">pop3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pop3</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="c1"># 打印调试信息
</span>        <span class="c1"># server.set_debuglevel(1)
</span>        <span class="c1"># 可选：打印POP3服务器欢迎信息
</span>        <span class="k">print</span><span class="p">(</span><span class="n">server</span><span class="o">.</span><span class="n">getwelcome</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">server</span><span class="o">.</span><span class="n">user</span><span class="p">(</span><span class="n">user</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">server</span><span class="o">.</span><span class="n">pass_</span><span class="p">(</span><span class="n">myEmail</span><span class="o">.</span><span class="n">decryptData</span><span class="p">(</span>
                <span class="n">user</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">myEmail</span><span class="o">.</span><span class="n">tempSelfPassWord</span><span class="p">))</span>
            <span class="n">loginStatus</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'身份认证失败，请重试！'</span><span class="p">)</span>
            <span class="n">loginStatus</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">chooseFunction</span><span class="p">()</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">loginStatus</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
                <span class="c1"># 可以用stat()函数返回邮件数量及占用空间
</span>                <span class="k">print</span><span class="p">(</span><span class="s">'邮件数量：</span><span class="si">%</span><span class="s">s；占用空间：</span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span> <span class="p">(</span><span class="n">server</span><span class="o">.</span><span class="n">stat</span><span class="p">()))</span>
                <span class="n">mails</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="nb">list</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">print</span><span class="p">(</span><span class="s">'开始打印收件箱(默认读取近15封邮件):'</span><span class="p">)</span>
                <span class="n">myEmail</span><span class="o">.</span><span class="n">mailHeader</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mails</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">mails</span><span class="p">)</span> <span class="o">-</span> <span class="mi">15</span><span class="p">,</span> <span class="n">server</span><span class="p">)</span>
                <span class="n">a</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'请选择要下载邮件的序号(想要查看的邮件不在上述邮件中？请不输入编号)：'</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r'^\d\d*'</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">lines</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">retr</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">))[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">msgContent</span> <span class="o">=</span> <span class="n">b</span><span class="s">'</span><span class="se">\r\n</span><span class="s">'</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">)</span>
                        <span class="n">msg</span> <span class="o">=</span> <span class="n">Parser</span><span class="p">()</span><span class="o">.</span><span class="n">parsestr</span><span class="p">(</span><span class="n">msgContent</span><span class="p">)</span>
                        <span class="k">print</span><span class="p">(</span>
                            <span class="s">'------------------------------------------------------------'</span><span class="p">)</span>
                        <span class="k">print</span><span class="p">(</span><span class="s">'第</span><span class="si">%</span><span class="s">s封邮件读取成功，下面显示邮件内容：'</span> <span class="o">%</span> <span class="n">a</span><span class="p">)</span>
                        <span class="k">print</span><span class="p">(</span>
                            <span class="s">'------------------------------------------------------------'</span><span class="p">)</span>
                        <span class="n">myEmail</span><span class="o">.</span><span class="n">parseMail</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                        <span class="k">print</span><span class="p">(</span>
                            <span class="s">'############################################################'</span><span class="p">)</span>
                        <span class="k">print</span><span class="p">(</span><span class="s">'第</span><span class="si">%</span><span class="s">s封邮件打印完毕'</span> <span class="o">%</span> <span class="n">a</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">'显示所有邮件：'</span><span class="p">)</span>
                    <span class="n">myEmail</span><span class="o">.</span><span class="n">mailHeader</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mails</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">server</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">server</span><span class="p">:</span>
                    <span class="n">server</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">'身份认证失败，请重试！'</span><span class="p">)</span>
                <span class="n">chooseFunction</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="s">''</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'建立新的账户：'</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'为保证数据安全，再次验证个人密钥'</span><span class="p">)</span>
        <span class="n">checked</span> <span class="o">=</span> <span class="n">myEmail</span><span class="o">.</span><span class="n">checkSelfPassword</span><span class="p">(</span><span class="n">myEmail</span><span class="o">.</span><span class="n">selfPassWord</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">checked</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'个人密钥验证通过！'</span><span class="p">)</span>
            <span class="n">selfPassWord</span> <span class="o">=</span> <span class="n">checked</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">i</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'请输入你要登陆的邮箱地址：'</span><span class="p">)</span>
            <span class="n">j</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'请输入你要登陆的邮箱密码：'</span><span class="p">)</span>
            <span class="n">k</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'请按smtp.example.com:port格式输入smtp服务器及端口：'</span><span class="p">)</span>
            <span class="n">m</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'smtp服务器采用SSL加密请按0，STARTTLS加密请按1:'</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">m</span> <span class="o">==</span> <span class="s">'1'</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="s">'1'</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">m</span> <span class="o">==</span> <span class="s">'0'</span>
            <span class="n">l</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s">'请按pop.example.com:port格式输入pop3服务器及端口：'</span><span class="p">)</span>
            <span class="n">myEmail</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">myEmail</span><span class="o">.</span><span class="n">encipherData</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">selfPassWord</span><span class="p">)))</span>
            <span class="n">myEmail</span><span class="o">.</span><span class="n">smtp</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">'@'</span><span class="p">)[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">':'</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">':'</span><span class="p">)[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">m</span><span class="p">)</span>
            <span class="n">myEmail</span><span class="o">.</span><span class="n">pop3</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">'@'</span><span class="p">)[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">l</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">':'</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">':'</span><span class="p">)[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">myEmail</span><span class="o">.</span><span class="n">updateAccounts</span><span class="p">()</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'pyEmail'</span><span class="p">,</span> <span class="s">'wb'</span><span class="p">)</span><span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">myEmail</span><span class="o">.</span><span class="n">accounts</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'新账号设置完毕！'</span><span class="p">)</span>
            <span class="n">chooseFunction</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'个人密钥验证失败，请重试!'</span><span class="p">)</span>
            <span class="n">chooseFunction</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'输入非法，请重试！'</span><span class="p">)</span>
        <span class="n">chooseFunction</span><span class="p">()</span>
<span class="n">chooseFunction</span><span class="p">()</span>
</code></pre></div></div>
<p>  其实用python来收发邮件都很简单的，因为有现成的模块供我们使用，我们需要注意的就是各个模块的各个方法需要传入的参数以及什么时候用什么方法，尤其是SSL加密协议和STARTTLS加密协议以及email.parse模块来解析邮件需要多多注意！</p>
